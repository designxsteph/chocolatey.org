@model ContactOwnersViewModel
@{
    ViewBag.Tab = "Packages";
    Bundles.Reference("content/css/chocolatey.bundle.min.css");
    Bundles.Reference("Scripts/main");
    Bundles.Reference("Scripts/validation");
}
@section TopScripts {
    <script>
        function onSubmit(token) {
            document.getElementById("i-recaptcha").submit();
        }
    </script>
    <script src='https://www.google.com/recaptcha/api.js' async defer></script>
}

@Html.Partial("~/Views/Shared/_AuthenticationSubNavigation.cshtml")
<section class="container py-3 py-xl-5">
    <div class="row">
        <div class="col-xl-10 mx-auto">
            <h2 class="text-center text-xl-start">Contact the Maintainers of <a href="@Url.Package(Model.PackageId,  null)">@Model.PackageId</a></h2>
            <hr />
            @if (Model.Owners.Any())
            {
                <div class="callout callout-secondary">
                    <p><strong>Is the package broken? and/or outdated?</strong></p>
                    <ul class="mb-0">
                        <li>First, please read over <a href="https://docs.chocolatey.org/en-us/community-repository/users/package-triage-process#package-is-broken">the package is broken / outdated</a>.</li>
                        <li>Provide a link to a gist with the output of running your command. Please add '-debug -verbose' to your command when reporting as most maintainers will ask for the debugging output.</li>
                    </ul>
                </div>
                <div class="callout callout-warning">
                    <p>
                        By submitting this form, you agree to <em>disclose your email address</em>
                        to the package maintainers listed below so they can reply to you.
                    </p>
                </div>
                <div class="callout callout-danger">
                    <p><strong>Do not share sensitive information with this form.</strong></p>
                </div>
                using (Html.BeginForm("ContactOwners", "Packages", FormMethod.Post, new { id = "i-recaptcha" }))
                {
                    <fieldset class="form">
                        <legend class="d-none">Contact Maintainers</legend>
                        @Html.AntiForgeryToken()
                        <div class="form-field d-flex align-items-center">
                            <h3 class="mb-0">To:</h3>
                            <input class="border-0 p-0 ms-1 bg-transparent h3 mb-0" name="NotUsed" type="text" value="@Model.Owners.Flatten(@<text>@item.Username</text>)" disabled="disabled" />
                        </div>
                        <div class="mt-3">
                            @if (!Model.ConfirmedUser)
                            {
                                @Html.LabelFor(m => m.Email) <span class="fas fa-asterisk text-primary small"></span>
                                @Html.TextBoxFor(m => m.Email, new { @class = "form-control mt-2" })
                                <div class="form-text">Provide your email address so we can follow up with you.</div>
                                @Html.ValidationMessageFor(m => m.Email)
                            }
                            else
                            {
                                <input class="form-control mt-2" type="hidden" id="Email" name="Email" value="test@example.com" />
                            }
                        </div>
                        <div class="mt-3">
                            @Html.LabelFor(m => m.Message) <span class="fas fa-asterisk text-primary small"></span>
                            @Html.TextAreaFor(m => m.Message, new { @rows = 5, @class = "form-control mt-2" })
                            @Html.ValidationMessageFor(m => m.Message)
                        </div>
                        <div class="form-check my-3">
                            @Html.CheckBoxFor(m => m.CopySender, new { @class = "form-check-input" })
                            <label class="form-check-label" for="CopySender">Send me a copy</label>
                        </div>
                        @if (ViewData.ModelState["SpamValidationResponse"] != null)
                        {
                            <ul class="list-unstyled callout callout-danger">
                                <li><strong>reCAPTCHA Error(s):</strong></li>
                                @foreach (var error in ViewData.ModelState["SpamValidationResponse"].Errors)
                                {
                                    <li>@Html.Raw(error.ErrorMessage)</li>
                                }
                            </ul>
                        }
                        <p class="mt-3"><small>Fields marked with</small> <span class="fas fa-asterisk text-primary small"></span> <small>are required.</small></p>
                        <input class="btn btn-primary g-recaptcha" data-sitekey="@System.Configuration.ConfigurationManager.AppSettings["reCAPTCHA::PublicKey"]" data-callback="onSubmit" data-badge="bottomleft" data-action="Form_ContactOwners" type="submit" value="Send Message" title="Send your message to the maintainers of '@Model.PackageId'" />
                    </fieldset>
                }
            }
            else
            {
                <div class="callout callout-danger">
                    <p><strong>Note:</strong> All the owners of this package have chosen not to receive email communication.</p>
                </div>
            }
        </div>
    </div>
</section>